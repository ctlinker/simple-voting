# Note de travail

## Travailler avec PHP en tant que projet

La commande de base pour commencer est `composer init` afin d'obtenir une structure de projet de base :

```tree
├── composer.json
├── src
└── vendor
    └── ...
```

Pour le développement, nous opterons généralement pour quelque chose comme ceci pour le dossier src :

```tree
├── src
  ├── tout ce que le client ne voit pas ou les logiques privées
  └── public
      └── tout ce que le client voit, par exemple index.php, api.php, vos pages
```

Nous pouvons ensuite servir notre projet avec :

```bash
php -S localhost:8000 -t src/public
```

ou simplement ajouter un script dans composer.json :

```json
  "scripts": {
    "serve": "php -S localhost:8000 -t src/public"
  }
```

et ensuite `composer serve`

## Travailler avec les espaces de noms

Les espaces de noms en PHP fonctionnent par `autoloading` via `vendor/autoload.php` ainsi que la section `autoload` de composer.json, par exemple :

en considérant une structure de projet minimale :

```tree
├── composer.json
├── src
│   ├── mock
│   │   └── MyClass.php
│   └── public
│       └── index.php
└── vendor
    ├── autoload.php
    └── ...
```

- index.php

  ```php
    <?php
    require __DIR__ . "/../../vendor/autoload.php";
    use Mock\MyClass;
    $m = new MyClass();
    echo $m->greet();
  ```

- MyClass.php

  ```php
  <?php
    namespace Mock;
    class MyClass
    {
        public function greet()
        {
            return "Bonjour de MyClass !";
        }
    }
  ```

- composer.json

  ```json
    "autoload": {
    "psr-4": {
      "Mock\\": "src/mock"
    }
  }
  ```

> [!NOTE] : Chaque fois que nous ajoutons un nouvel espace de noms ou un fichier à un espace de noms existant, nous devons exécuter la commande `composer dump-autoload`

> [!WARNING] : Les espaces de noms sont sensibles à la casse et étroitement liés au fichier qui les contient. Ils doivent être déclarés dans un fichier dont le nom est identique à la classe qu'ils contiennent ou au moins identique à l'une d'entre elles :
> par exemple : `class MyClass` dans `MyClass.php`
> si nous avions une deuxième classe, nous aurions fait : `class MyClass2` dans `MyClass2.php`
> ou nous aurions pu être plus spécifiques dans l'autoloading, par exemple :

  ```json
    "autoload": {
    "psr-4": {
      "Mock\\Myclass1": "src/mock/Classes.php",
      "Mock\\Myclass2": "src/mock/Classes.php",
      "Mock\\Myclass3": "src/mock/Classes.php"
    }
  }
  ```
